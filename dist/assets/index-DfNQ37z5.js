import{r as s,a9 as R}from"./index-ABcspcLt.js";import{M as S,s as W,u as I,P as D,t as H,v as K,L as T}from"./site-header-DWJpDH6n.js";function k(e,o){if(typeof e=="function")return e(o);e!=null&&(e.current=o)}function U(...e){return o=>{let t=!1;const i=e.map(r=>{const n=k(r,o);return!t&&typeof n=="function"&&(t=!0),n});if(t)return()=>{for(let r=0;r<i.length;r++){const n=i[r];typeof n=="function"?n():k(e[r],null)}}}}function B(...e){return s.useCallback(U(...e),e)}class F extends s.Component{getSnapshotBeforeUpdate(o){const t=this.props.childRef.current;if(t&&o.isPresent&&!this.props.isPresent){const i=t.offsetParent,r=W(i)&&i.offsetWidth||0,n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft,n.right=r-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function G({children:e,isPresent:o,anchorX:t,root:i}){const r=s.useId(),n=s.useRef(null),h=s.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:g}=s.useContext(S),w=B(n,e==null?void 0:e.ref);return s.useInsertionEffect(()=>{const{width:u,height:m,top:l,left:a,right:p}=h.current;if(o||!n.current||!u||!m)return;const C=t==="left"?`left: ${a}`:`right: ${p}`;n.current.dataset.motionPopId=r;const c=document.createElement("style");g&&(c.nonce=g);const E=i??document.head;return E.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${m}px !important;
            ${C}px !important;
            top: ${l}px !important;
          }
        `),()=>{E.contains(c)&&E.removeChild(c)}},[o]),R.jsx(F,{isPresent:o,childRef:n,sizeRef:h,children:s.cloneElement(e,{ref:w})})}const V=({children:e,initial:o,isPresent:t,onExitComplete:i,custom:r,presenceAffectsLayout:n,mode:h,anchorX:g,root:w})=>{const u=I(X),m=s.useId();let l=!0,a=s.useMemo(()=>(l=!1,{id:m,initial:o,isPresent:t,custom:r,onExitComplete:p=>{u.set(p,!0);for(const C of u.values())if(!C)return;i&&i()},register:p=>(u.set(p,!1),()=>u.delete(p))}),[t,u,i]);return n&&l&&(a={...a}),s.useMemo(()=>{u.forEach((p,C)=>u.set(C,!1))},[t]),s.useEffect(()=>{!t&&!u.size&&i&&i()},[t]),h==="popLayout"&&(e=R.jsx(G,{isPresent:t,anchorX:g,root:w,children:e})),R.jsx(D.Provider,{value:a,children:e})};function X(){return new Map}const P=e=>e.key||"";function z(e){const o=[];return s.Children.forEach(e,t=>{s.isValidElement(t)&&o.push(t)}),o}const q=({children:e,custom:o,initial:t=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:n="sync",propagate:h=!1,anchorX:g="left",root:w})=>{const[u,m]=H(h),l=s.useMemo(()=>z(e),[e]),a=h&&!u?[]:l.map(P),p=s.useRef(!0),C=s.useRef(l),c=I(()=>new Map),[E,b]=s.useState(l),[x,$]=s.useState(l);K(()=>{p.current=!1,C.current=l;for(let d=0;d<x.length;d++){const f=P(x[d]);a.includes(f)?c.delete(f):c.get(f)!==!0&&c.set(f,!1)}},[x,a.length,a.join("-")]);const M=[];if(l!==E){let d=[...l];for(let f=0;f<x.length;f++){const y=x[f],j=P(y);a.includes(j)||(d.splice(f,0,y),M.push(y))}return n==="wait"&&M.length&&(d=M),$(z(d)),b(l),null}n==="wait"&&x.length>1&&console.warn(`You're attempting to animate multiple children within AnimatePresence, but its mode is set to "wait". This will lead to odd visual behaviour.`);const{forceRender:v}=s.useContext(T);return R.jsx(R.Fragment,{children:x.map(d=>{const f=P(d),y=h&&!u?!1:l===x||a.includes(f),j=()=>{if(c.has(f))c.set(f,!0);else return;let L=!0;c.forEach(A=>{A||(L=!1)}),L&&(v==null||v(),$(C.current),h&&(m==null||m()),i&&i())};return R.jsx(V,{isPresent:y,initial:!p.current||t?void 0:!1,custom:o,presenceAffectsLayout:r,mode:n,root:w,onExitComplete:y?void 0:j,anchorX:g,children:d},f)})})};export{q as A};
